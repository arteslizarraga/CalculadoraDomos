<!DOCTYPE HTML>
<html>
	<head> 
		<meta charset="UTF-8"> 
		<link rel="stylesheet" href="css/estilos.css">
		<script src="js/funcionesGenericas.js"></script>
		<script src="js/medidasDomoIcosaedro.js"></script>
	</head>
<body>

<div style="display: none" id="loading-spinner"></div> <!-- Imagen de carga de datos -->

<!--
<img name="img_dome_22_8v_0_5" src="Data/Geodesic_Dome/draw.cgi?n=22&amp;f=8v&amp;nox=1_2&amp;d=6.00&amp;hr=0.5" class="foto"><br><div class="desc">Geodesic 8V Icosahedron Dome (Human is 170cm/5'7")</div>
-->

<table border="1" width="100%">
	<tr style="background-color: #a89292; ">
		<td>  
			Frecuencia:
			<select id="cbx_frecuencia_domo" onchange="calcularDomo();">
				<option value="V4"> V4 </option>
				<option value="V6"> V6 </option>
				<option value="V8" selected> V8 </option>
			</select>
		</td>
		<td> 
			<table>
				<tr>
					<td> Diámetro del domo: </td>
					<td> 
						<input id="txt_diametro" value="13.00"> 
					</td>
					<td> 
						<select id="cbx_unidad_de_medida" onchange="calcularDomo();">
							<option value="centimetros"> centimetros </option>
							<option value="metros" selected> metros </option>
							<option value="pulgadas"> pulgadas </option>
						</select>
					</td>
					<td> <button type="button" onclick="calcularDomo();"> Calcular </button> </td>
				</tr>
				<tr>
					<td> Redondear resultados: </td>
					<td>  
						<select id="cbx_redondear_resultados" onchange="calcularDomo();">
							<option value="si"> si </option>
							<option value="no" selected> no </option>
						</select>
					</td>
					<td> </td>
					<td> </td>
				</tr>
			</table>			
		</td>
		<td></td>
	</tr>
	<tr>
		<td>
			<table id="tablaDomo" border="1"> 
				<thead> 
					<tr> 
						<th> Letra </th> 
						<th> Medidas </th> 
					</tr> 
				</thead> 
				<tbody></tbody> 
			</table> 
		</td>
		<td>
			<h4 id="descripcion_domo"></h4>

			<table>
				<tr>
					<td> Altura del domo: </td>
					<td> <input type="text" id="alturaDomo" disabled> </td>
				</tr>
				<tr>
					<td> Cantidad de triángulos: </td>
					<td> <input type="text" id="cantidadTriangulos" disabled> </td>
				</tr>
			</table>

			<img id="diagrama_construccion" onclick="abrirImagen(event)" style="width: 80%;" />
		</td>
		<td>
			<img id="imagen_resultado" onclick="abrirImagen(event)" />
		</td>
	</tr>
</table>

</script>


<script>

const abrirImagen = (evento) =>
{
	let medidasImagen = "location=yes,height=570,width=520,scrollbars=yes,status=yes";
	window.open(evento.target.src, "_blank", medidasImagen);
}

const calcularDomo = async () => 
{
	await new Promise((resolver, rechazar) => 
	{
		mostrarLoadingSpinner(); 

		let diametro = document.querySelector("#txt_diametro").value;
		let radio = diametro / 2;

		var tablaDomo = document.getElementById("tablaDomo").getElementsByTagName("tbody")[0]; 
		tablaDomo.innerHTML = "";   // Limpia la tabla 

		var domoSeleccionado = medidasDomoIcosaedro.find(c=> c.nombre == document.querySelector("#cbx_frecuencia_domo").value);

		let redondearResultados = (document.querySelector("#cbx_redondear_resultados").value == "si") ? true : false;

		domoSeleccionado.medidas.sort((a, b) => b.letra.localeCompare(a.letra)).forEach(c=> 
		{
			var fila = tablaDomo.insertRow(0);
			fila.insertCell(0).innerHTML = c.letra; 

			if (redondearResultados) {
				fila.insertCell(1).innerHTML = (radio * c.factorCoordenada).toString().substring(0,5);
			}
			else {
				fila.insertCell(1).innerHTML = Math.round((radio * c.factorCoordenada) * 10000) / 10000;
			}
		});

		var unidadDeMedida = document.querySelector("#cbx_unidad_de_medida").value;

		document.querySelector("#alturaDomo").value = (Math.round((diametro * 0.5) * 10000) / 10000) + " " + unidadDeMedida;   // Esta es la altura del domo

		document.querySelector("#cantidadTriangulos").value = domoSeleccionado.cantidadTriangulos;    // Cantidad de triangulos

		//document.img_dome_22_8v_0_5.src = 'Data/Geodesic_Dome/draw.cgi?n=22&f=8v&nox=1_2&d='+diametro+'&hr=0.5';

		document.querySelector("#descripcion_domo").innerHTML = domoSeleccionado.descripcion;
		document.querySelector("#diagrama_construccion").src = domoSeleccionado.imagenDiagramaConstruccion;
		document.querySelector("#imagen_resultado").src = domoSeleccionado.imagenResultado;

		/*
		setTimeout(function(){
			resolver(); // Todo salió bien. Esto forma parte del promise
		}, 700);
		*/
		resolver(); // Esto forma parte del promise
	})
	.catch(() => {
		alert("Se encontró un error");
	})
	.then(() => {
		ocultarLoadingSpinner();
	});
}

calcularDomo();

//=============================================================>>>>>
/*
(async () => {
	await (() => {
		console.log("has algo")
	})()
})()
.then(() => {
  console.log("terminó");
});
*/

</script>

</body>
</html>

